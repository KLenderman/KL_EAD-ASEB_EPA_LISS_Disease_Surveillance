---
title: "LIS Oyster Lab Tissue Processing"
output: html_notebook

description: This R code is used to import and summarize tissue processing data (body condition, height/length/width, weight, sample collection) from the LISS Oyster Health Project's monthly sampling at Ash Creek and Fence Creek intertidal sites in Connecticut and Goldstar beach and Laurel Hollow subtidal sites on Long Island, NY. 
---

Updated 11/22/2023 by M. Kachmar
- added description to the code above
- facet wrapped the histograms by month for body condition distribution
 

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 


```{r, echo=FALSE}
library("dplyr")                                    
library("plyr")                                     
library("readr")             
library("Rmisc")
library("ggplot2")
library("lubridate")
```

```{r}
#Set Path
setwd("C:/Users/mariah.kachmar/Documents/Github/EAD-ASEB_EPA_LISS_Disease_Surveillance/Lab_Data_TissueProcessing")
```

#Reading in google sheets from the good drive

```{r}
#Install the required package
#install.packages('googlesheets4')

library(googlesheets4)
```

```{r}
#ASHC_0423 <- read_sheet("https://docs.google.com/spreadsheets/d/1FTIfau5DBKxqmWdYpQB--2qYXgYGwsqRw3Qxy7Zi7Wk/edit?usp=drive_link")
```

```{r}
#head(ASHC_0423)
```

### This code chunk merges all .csv files within the Tissue processing folder into one data frame and outputs the full dataset into a .csv master file. This allows us to download the raw data as a .csv, add it to the repository folder, and create the master data file without copying and pasting data in excel.
# reading in .csv files from local folder
```{r}
data_all <- list.files(path = "C:/Users/mariah.kachmar/Documents/Github/EAD-ASEB_EPA_LISS_Disease_Surveillance/Lab_Data_TissueProcessing/Files_by_Month",                           # Identify all CSV files
  pattern = "*.csv", full.names = TRUE) %>% 
  lapply(read_csv) %>%                              # Store all files in list
  bind_rows                                         # Combine data sets into one data set 
data_all                                            # Print data to RStudio console

as.data.frame(data_all)                            # Convert tibble to data.frame

write.csv(data_all, "C:/Users/mariah.kachmar/Documents/Github/EAD-ASEB_EPA_LISS_Disease_Surveillance/Lab_Data_TissueProcessing\\All_tissue_processing_data.csv", row.names=FALSE)
 
```


## adding a month column to the data

```{r}
data_all <- data_all %>%
  mutate(date_collected= as.Date(date_collected), month = month(date_collected))

data_all
```

# This chunk of code creates a numerical value in a new column for the body condition scores
```{r}

data_all<- data_all %>%
  mutate(condition_score = recode(condition, 
                                     "1_very_good" = 1, "2_good" = 2, "3_good_minus"= 3, "4_fair_plus"= 4, "5_fair"= 5,"6_fair_minus"= 6, "7_poor_plus"=7,
                                     "8_poor"= 8, "9_very_poor"= 9))
head(data_all)


```
```{r}
```

# Summary of all data 
```{r}
st_height <- summarySE(data_all, measurevar="height_mm", groupvars=c("site", "date_collected"))
st_height 

#Calculate completeness for QC
st_height$Completeness <- st_height$N /30

st_height

write.csv(st_height, "C:/Users/mariah.kachmar/Documents/Github/EAD-ASEB_EPA_LISS_Disease_Surveillance/Lab_Data_TissueProcessing\\Completeness_tissue_processing_data.csv", row.names=FALSE)
```

```{r}
ggplot(data=data_all, aes(x=site, y=height_mm, fill=site)) +
  geom_boxplot()+  #scale_fill_manual(values=c("forestgreen","orange", "purple"))+
  theme_bw() +  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+ 
  #theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
  labs(title="Mean Shell Height ", x ="site", y = "Mean Shell Height (mm)")
```

```{r}

ggplot(data=data_all, aes(x=site, y=condition_score, fill=site)) +
  geom_boxplot()+  #scale_fill_manual(values=c("forestgreen","orange", "purple"))+
  theme_bw() +  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+ 
  #theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
  labs(title="Mean Body Condition ", x ="site", y = "Mean Body condition score")
```

# Ash Creek Summary
```{r}

df_ASHC<- data_all%>%
  filter(site=="ASHC")
df_ASHC

## Shell Height ##
st_height_ASHC <- summarySE(df_ASHC, measurevar="height_mm", groupvars=c("date_collected"))
st_height_ASHC

## Body Condition ##
#Excludes April and May due to scoring change. These months are scored categorically 'fat, medium, watery'. 

st_condition_ASHC<- summarySE(df_ASHC, measurevar = "condition_score", groupvars = c("date_collected"))
st_condition_ASHC

```


```{r}
ggplot(data=df_ASHC, aes(x=month, y=height_mm, group= month)) +
  geom_boxplot()+  #scale_fill_manual(values=c("forestgreen","orange", "purple"))+
  theme_bw() +  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+ 
  #theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
  labs(title="Mean Shell Height ", x ="month", y = "Mean Shell Height (mm)")
```

```{r}
#Condition distribution across all sample months
ggplot(data=df_ASHC, aes(x= condition)) +
  geom_bar()+  #scale_fill_manual(values=c("forestgreen","orange", "purple"))+
  theme_bw() +  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+ 
  #theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
  labs(title="Body Condition Score ", x ="Condition categorization")+
  facet_wrap(~ month, scales = "free")

#Mean Body condition per month
ggplot(data=df_ASHC, aes(x= month, y= condition_score, group = month)) +
  geom_boxplot()+  #scale_fill_manual(values=c("forestgreen","orange", "purple"))+
  theme_bw() +  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+ 
  #theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
  labs(title="Mean Body Condition Score ", x ="month", y= " condition score (1-9)") + scale_y_reverse()

## Mean body condition per 'Zone'
ggplot(data=df_ASHC, aes(x= oyster_zone, y= condition_score, group = oyster_zone, fill = oyster_zone)) +
  geom_boxplot()+  #scale_fill_manual(values=c("forestgreen","orange", "purple"))+
  theme_bw() +  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+ 
  #theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
  labs(title="Mean Body Condition Score ", x ="Zone", y= " condition score (1-9)") + scale_y_reverse()


```



# Fence Creek Summary
```{r}
df_FENC<- data_all%>%
  filter(site=="FENC")
df_FENC

## Shell Height ##
st_height_FENC <- summarySE(df_FENC, measurevar="height_mm", groupvars=c("date_collected"))
st_height_FENC 

## Body Condition ##
#Excludes April and May due to scoring change. These months are scored categorically 'fat, medium, watery'. 

st_condition_FENC<- summarySE(df_FENC, measurevar = "condition_score", groupvars = c("date_collected"))
st_condition_FENC

```


```{r}
ggplot(data=df_FENC, aes(x=month, y=height_mm, group=month)) +
  geom_boxplot()+  #scale_fill_manual(values=c("forestgreen","orange", "purple"))+
  theme_bw() +  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+ 
  #theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
  labs(title="Mean Shell Height ", x ="month", y = "Mean Shell Height (mm)")

```

```{r}
#Condition distribution across all sample months
ggplot(data=df_FENC, aes(x= condition)) +
  geom_bar()+  #scale_fill_manual(values=c("forestgreen","orange", "purple"))+
  theme_bw() +  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+ 
  #theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
  labs(title="Body Condition index ", x ="Condition categorization")+
    facet_wrap(~ month, scales = "free")

#Mean Body condition per month
ggplot(data=df_FENC, aes(x= month, y= condition_score, group = month)) +
  geom_boxplot()+  #scale_fill_manual(values=c("forestgreen","orange", "purple"))+
  theme_bw() +  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+ 
  #theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
  labs(title="Mean Body Condition Score", x ="month", y= " condition score (1-9)")+ scale_y_reverse()

## Mean body condition per 'Zone'
ggplot(data=df_FENC, aes(x= oyster_zone, y= condition_score, group = oyster_zone, fill = oyster_zone)) +
  geom_boxplot()+  #scale_fill_manual(values=c("forestgreen","orange", "purple"))+
  theme_bw() +  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+ 
  #theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
  labs(title="Mean Body Condition Score ", x ="Zone", y= " condition score (1-9)")+ scale_y_reverse()

## Mean body condition per 'light regime'
ggplot(data=df_FENC, aes(x= light_regime, y= condition_score, group = light_regime, fill = light_regime)) +
  geom_boxplot()+  #scale_fill_manual(values=c("forestgreen","orange", "purple"))+
  theme_bw() +  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+ 
  #theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
  labs(title="Mean Body Condition Score ", x ="Zone", y= " condition score (1-9)")+ scale_y_reverse()

```




# Laurel Hollow Summary
```{r}
df_LAUR<- data_all%>%
  filter(site=="LAUR")

## Shell Height ##
st_height_LAUR <- summarySE(df_LAUR, measurevar="height_mm", groupvars=c("date_collected"))
st_height_LAUR 

## Body Condition ##
## Excludes May due to scoring system change. May scored fat, medium, watery. 
st_condition_LAUR<- summarySE(df_LAUR, measurevar = "condition_score", groupvars = c("date_collected"))
st_condition_LAUR
```

```{r}
ggplot(data=df_LAUR, aes(x=month, y=height_mm, group= month)) +
  geom_boxplot()+  #scale_fill_manual(values=c("forestgreen","orange", "purple"))+
  theme_bw() +  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+ 
  #theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
  labs(title="Mean Shell Height ", x ="month", y = "Mean Shell Height (mm)")


```
```{r}
#Condition distribution across all sample months
ggplot(data=df_LAUR, aes(x= condition)) +
  geom_bar()+  #scale_fill_manual(values=c("forestgreen","orange", "purple"))+
  theme_bw() +  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+ 
  #theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
  labs(title="Body Condition index ", x ="Condition categorization")+
    facet_wrap(~ month, scales = "free")

#Mean Body condition per month
ggplot(data=df_LAUR, aes(x= month, y= condition_score, group = month)) +
  geom_boxplot()+  #scale_fill_manual(values=c("forestgreen","orange", "purple"))+
  theme_bw() +  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+ 
  labs(title="Mean Body Condition Score ", x ="month", y= " condition score (1-9)")+ scale_y_reverse()
  #theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+

```


# Gold Star Beach Summary
```{r}
df_GOLD<- data_all%>%
  filter(site=="GOLD")

## Shell Height ##
st_height_GOLD <- summarySE(df_GOLD, measurevar="height_mm", groupvars=c("date_collected"))
st_height_GOLD 

## Body Condition ##
st_condition_GOLD<- summarySE(df_GOLD, measurevar = "condition_score", groupvars = c("date_collected"))
st_condition_GOLD

```

```{r}
ggplot(data=df_GOLD, aes(x=month, y=height_mm, group= month)) +
  geom_boxplot()+  #scale_fill_manual(values=c("forestgreen","orange", "purple"))+
  theme_bw() +  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+ 
  #theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
  labs(title="Mean Shell Height ", x ="month", y = "Mean Shell Height (mm)")

```
```{r}
#Condition distribution across all sample months
ggplot(data=df_GOLD, aes(x= condition)) +
  geom_bar()+  #scale_fill_manual(values=c("forestgreen","orange", "purple"))+
  theme_bw() +  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+ 
  #theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
  labs(title="Body Condition Score ", x ="Condition categorization")+
    facet_wrap(~ month, scales = "free")

#Mean Body condition per month
ggplot(data=df_GOLD, aes(x= month, y= condition_score, group = month)) +
  geom_boxplot()+  #scale_fill_manual(values=c("forestgreen","orange", "purple"))+
  theme_bw() +  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+ 
  labs(title="Mean Body Condition Score ", x ="month", y= " condition score (1-9)")+ scale_y_reverse()
  #theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+

```




```{r}
sessionInfo()
```


Add a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Ctrl+Alt+I*.

When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Ctrl+Shift+K* to preview the HTML file).

The preview shows you a rendered HTML copy of the contents of the editor. Consequently, unlike *Knit*, *Preview* does not run any R code chunks. Instead, the output of the chunk when it was last run in the editor is displayed.
