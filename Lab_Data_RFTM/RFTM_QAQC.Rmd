---
title: "RFTM"
author: "Katie McFarland"
date: "6/29/2023"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, echo=FALSE}
library("dplyr")                                    
library("plyr")                                     
library("readr")             
library("Rmisc")
library("ggplot2")
library("lubridate")
```

```{r}
#Set Path
setwd("C:/Users/katherine.mcfarland/Documents/GitHub/EAD-ASEB_EPA_LISS_Disease_Surveillance/Lab_Data_RFTM")
```

### This code chunk merges all .csv files within the Tissue processing folder into one data fram and outputs the full dataset into a .csv master file. This allows us to download the raw data as a .csv, add it to the repository folder, and create the master data file without copying and pasting data in excel.
# reading in .csv files from local folder
```{r}
data_all <- list.files(path = "C:/Users/katherine.mcfarland/Documents/GitHub/EAD-ASEB_EPA_LISS_Disease_Surveillance/Lab_Data_RFTM/Files_by_Month",                           # Identify all CSV files
  pattern = "*.csv", full.names = TRUE) %>% 
  lapply(read_csv) %>%                              # Store all files in list
  bind_rows                                         # Combine data sets into one data set 
data_all                                            # Print data to RStudio console

as.data.frame(data_all)                            # Convert tibble to data.frame

write.csv(data_all, "C:/Users/katherine.mcfarland/Documents/GitHub/EAD-ASEB_EPA_LISS_Disease_Surveillance/Lab_Data_RFTM\\All_RFTM_data.csv", row.names=FALSE)
```


## Need to figure out how to fix the date !!!!
 https://lubridate.tidyverse.org/
```{r}
str(data_all)

# convert date info in format 'mm/dd/yyyy'
data_all$date <- ymd("2023-04-23")

str(data_all)

```

# Summary of all data and Completeness Check
```{r}
st_rftm_final <- summarySE(data_all, measurevar="rftm_final", groupvars=c("site", "date_collected"))
st_rftm_final

#Calculate completeness for QC
st_rftm_final$Completeness <- st_rftm_final$N /30

st_rftm_final

write.csv(st_rftm_final, "C:/Users/katherine.mcfarland/Documents/GitHub/EAD-ASEB_EPA_LISS_Disease_Surveillance/Lab_Data_RFTM\\Completeness_RFTM_intensity_data.csv", row.names=FALSE)
```

# Comparied reader 1 and reader 2
  --- THis is not currently working properly -- Currently calling everything with two reads to be TRUE
  
```{r}
data_all$results = ifelse(data_all$rftm_intensity_read1 < data_all$rftm_intensity_read2, 'FALSE',
  ifelse(data_all$rftm_intensity_read1 < data_all$rftm_intensity_read2, 'FALSE',
  ifelse(data_all$rftm_intensity_read1 == data_all$rftm_intensity_read2, 'TRUE', NA)))
  
data_all
```



```{r}
Data_Accuracy = data.frame(data_all$lab_id,data_all$date_collected, data_all$site, data_all$rftm_intensity_read1, data_all$rftm_intensity_read2, data_all$results)

Data_Accuracy <- na.omit(Data_Accuracy)
Data_Accuracy
```

```{r}
#count TRUE values in vector
x <- Data_Accuracy %>% 
  dplyr::group_by(data_all.site, data_all.date_collected, data_all.results) %>% 
  dplyr::summarise(count = n())
x2 <- x %>% 
  dplyr::group_by()

T <- nrow(Data_Accuracy %>% filter(data_all.results == 'TRUE'))
F <- nrow(Data_Accuracy %>% filter(data_all.results == 'FALSE'))

Accuracy <- T/(T+F)
Accuracy

#write.csv(Data_Accuracy, "C:/Users/katherine.mcfarland/Documents/GitHub/EAD-ASEB_EPA_LISS_Disease_Surveillance/Lab_Data_RFTM\\Accuracy_RFTM_intenisty_data.csv", row.names=FALSE)
```

